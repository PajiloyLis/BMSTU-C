#include "algorithms.h"
#include <check.h>

#define EPS 1e-9
#define MAX_STR_LEN 21
typedef struct test_struct test_struct;

struct test_struct
{
    int a, b;
    double c;
};

int compare_test_struct(const void *a, const void *b)
{
    test_struct *first = (test_struct *)a, *second = (test_struct *)b;
    if (first->a > second->a)
        return 1;
    else if (first->a < second->a)
        return -1;
    else
    {
        if (first->b < second->b)
            return 1;
        else if (first->b > second->b)
            return -1;
        else
        {
            if (first->c - second->c < EPS)
                return -1;
            else if (first->c - second->c > EPS)
                return 1;
            return 0;
        }
    }
}

int compare_double(const void *a, const void *b)
{
    double res = (*(double *)a - *(double *)b);
    if (res < EPS)
        return -1;
    else if (res > EPS)
        return 1;
    return 0;
}

int compare_string(const void *a, const void *b)
{
    return strcmp(a, b);
}

START_TEST(test_mysort_int_5)
{
    int p_b[] = {5, 4, 3, 2, 1};
    size_t n = 5;
    mysort(p_b, n, sizeof(int), compare_int);
    int ans[] = {1, 2, 3, 4, 5};
    for (size_t i = 0; i < n; ++i)
    {
        ck_assert_int_eq(p_b[i], ans[i]);
    }
}
END_TEST

START_TEST(test_mysort_int_100)
{
    int p_b[] = {1283169651, 721796368, 1770790779, 700631423, 1048620040, 1957331771,
                 1730554937, 1093563093, 363743468, 1725659690, 995427512, 738562164, 938919176,
                 2014958803, 1677388894, 1401294681, 450976682, 1308290108, 1351468334, 790769584,
                 1046198315, 1763593250, 1811917361, 970164491, 1848460232, 2121420011, 228496590,
                 1088157395, 1482772659, 270795911, 728269823, 997150840, 1034348823, 2011414353,
                 516741921, 1582243905, 1565484242, 1870571349, 671609987, 275301308, 33448262,
                 1972722089, 845899647, 801051239, 243973988, 1543969650, 1459925446, 373181004,
                 589677231, 1137230168, 1426337384, 476372038, 1207469297, 1125165432, 1408481111,
                 390334724, 1162822025, 1436378204, 1509801729, 1789269253, 1768258814, 1928394448,
                 1790118797, 27832291, 800978109, 948710846, 146091462, 2053783982, 1654123640,
                 2089982354, 1738478317, 449633877, 969615581, 125462617, 1957301167, 1743345260,
                 899399681, 1957797337, 59429873, 678057874, 1471395753, 268353948, 1675248246,
                 806628992, 997290864, 1397565844, 491843217, 1264303966, 1838838686, 855809202,
                 1133726559, 1589480449, 115864655, 931384099, 1875740415, 40644023, 527839221,
                 1436594165, 1508307095, 1785335867};
    size_t n = sizeof(p_b)/sizeof(p_b[0]);
    mysort(p_b, n, sizeof(int), compare_int);
    int ans[] = {27832291, 33448262, 40644023, 59429873, 115864655, 125462617, 146091462, 228496590,
                 243973988, 268353948, 270795911, 275301308, 363743468, 373181004, 390334724, 449633877,
                 450976682, 476372038, 491843217, 516741921, 527839221, 589677231, 671609987, 678057874,
                 700631423, 721796368, 728269823, 738562164, 790769584, 800978109, 801051239, 806628992,
                 845899647, 855809202, 899399681, 931384099, 938919176, 948710846, 969615581, 970164491,
                 995427512, 997150840, 997290864, 1034348823, 1046198315, 1048620040, 1088157395, 1093563093,
                 1125165432, 1133726559, 1137230168, 1162822025, 1207469297, 1264303966, 1283169651, 1308290108,
                 1351468334, 1397565844, 1401294681, 1408481111, 1426337384, 1436378204, 1436594165, 1459925446,
                 1471395753, 1482772659, 1508307095, 1509801729, 1543969650, 1565484242, 1582243905, 1589480449,
                 1654123640, 1675248246, 1677388894, 1725659690, 1730554937, 1738478317, 1743345260, 1763593250,
                 1768258814, 1770790779, 1785335867, 1789269253, 1790118797, 1811917361, 1838838686, 1848460232,
                 1870571349, 1875740415, 1928394448, 1957301167, 1957331771, 1957797337, 1972722089, 2011414353,
                 2014958803, 2053783982, 2089982354, 2121420011};
    for (size_t i = 0; i < n; ++i)
    {
        ck_assert_int_eq(p_b[i], ans[i]);
    }
}
END_TEST

START_TEST(test_mysort_double_50)
{
    double p_b[] = {1311054806.7374485, 455315851.0326518, 194092398.47024035,
                    797083179.8728585, 760235949.8382095, 447040005.3081543, 162170269.4708403,
                    1189579365.3162782, 198159215.81541917, 393351593.96573395, 295031398.91463625,
                    62106580.89363661, 1611894294.7702353, 1970024867.0666735, 155730124.98476344,
                    57102366.93871388, 361883017.0407342, 334419117.33965814, 37173671.5533874,
                    513091218.2984327, 1423077659.2752142, 157558488.49396893, 394897862.49933445,
                    36000900.16836354, 184898929.94893286, 30247744.72095744, 376911668.30937964,
                    110867803.56557266, 1073019760.7821697, 480470281.5961715, 176351527.4616129,
                    925596118.2468184, 380840850.8190987, 230742036.07231635, 814751184.7568275,
                    315557401.09138614, 623211858.0410848, 864528172.0061271, 309705817.9147482,
                    998429450.733415, 1160789219.3899467, 529165721.11720604, 135595297.63136044,
                    310501653.6444128, 621046086.6615386, 1046596123.9887731, 97074922.02222694,
                    240476874.0865567, 218233120.49122545, 386890998.64912546};
    size_t n = sizeof(p_b)/sizeof(p_b[0]);
    mysort(p_b, n, sizeof(double), compare_double);
    double ans[] = {30247744.72095744, 36000900.16836354, 37173671.5533874,
                    57102366.93871388, 62106580.89363661, 97074922.02222694, 110867803.56557266,
                    135595297.63136044, 155730124.98476344, 157558488.49396893, 162170269.4708403,
                    176351527.4616129, 184898929.94893286, 194092398.47024035, 198159215.81541917,
                    218233120.49122545, 230742036.07231635, 240476874.0865567, 295031398.91463625,
                    309705817.9147482, 310501653.6444128, 315557401.09138614, 334419117.33965814,
                    361883017.0407342, 376911668.30937964, 380840850.8190987, 386890998.64912546,
                    393351593.96573395, 394897862.49933445, 447040005.3081543, 455315851.0326518,
                    480470281.5961715, 513091218.2984327, 529165721.11720604, 621046086.6615386,
                    623211858.0410848, 760235949.8382095, 797083179.8728585, 814751184.7568275,
                    864528172.0061271, 925596118.2468184, 998429450.733415, 1046596123.9887731,
                    1073019760.7821697, 1160789219.3899467, 1189579365.3162782, 1311054806.7374485,
                    1423077659.2752142, 1611894294.7702353, 1970024867.0666735};
    for (size_t i = 0; i < n; ++i)
    {
        ck_assert_double_eq(p_b[i], ans[i]);
    }
}
END_TEST

START_TEST(test_mysort_string_20)
{
    char p_b[][MAX_STR_LEN] = {"zetrqib",
                               "xhwaqtgrclaqz",
                               "bgtfwe",
                               "eqnvmiymqwj",
                               "eahcgxrehnx",
                               "bbqnaxtaawjbqncxym",
                               "veghoaoxbxqs",
                               "epwcnf",
                               "vvydtmojelrm",
                               "pw",
                               "htozmcyeddzeezhxizyt",
                               "wun",
                               "v",
                               "bbmpodhyvceyv",
                               "havuczuzegmaq",
                               "mfpfjlfovjby",
                               "hmrnzt",
                               "fenxoltrj",
                               "bvnbkogzqvj",
                               "akqovdcucw"};
    size_t n = sizeof(p_b)/sizeof(p_b[0]);
    mysort(p_b, n, MAX_STR_LEN, compare_string);
    char ans[][MAX_STR_LEN] = {"akqovdcucw",
                               "bbmpodhyvceyv",
                               "bbqnaxtaawjbqncxym",
                               "bgtfwe",
                               "bvnbkogzqvj",
                               "eahcgxrehnx",
                               "epwcnf",
                               "eqnvmiymqwj",
                               "fenxoltrj",
                               "havuczuzegmaq",
                               "hmrnzt",
                               "htozmcyeddzeezhxizyt",
                               "mfpfjlfovjby",
                               "pw",
                               "v",
                               "veghoaoxbxqs",
                               "vvydtmojelrm",
                               "wun",
                               "xhwaqtgrclaqz",
                               "zetrqib"};
    for (size_t i = 0; i < n; ++i)
    {
        ck_assert_str_eq(p_b[i], ans[i]);
    }
}
END_TEST

START_TEST(test_mysort_struct_20)
{
    test_struct p_b[] = {{116260642, 447552228, 0.194252},
                         {-366221015, -126458399, 0.723053},
                         {-110991212, -510032329, 0.576508},
                         {-1336448236, 1869146920, 0.197217},
                         {-337560122, 352710789, 0.249193},
                         {-1417845659, -1119140084, 0.352222},
                         {-2125286972, 2003543025, 0.189025},
                         {-606803352, -351912708, 0.54285},
                         {-1170970232, 613641466, 0.0319744},
                         {-127025483, 371115427, 0.591437},
                         {34617024, -2060044297, 0.672914},
                         {-654172947, -1373821604, 0.00731686},
                         {769863531, 2122219585, 0.44431},
                         {500415026, -1704242636, 0.00945362},
                         {310589293, 1748639608, 0.143025},
                         {95986820, 362881936, 0.979554},
                         {-1406836364, 217123097, 0.16737},
                         {-243642100, -1888439679, 0.281376},
                         {233587817, -803492744, 0.947917},
                         {-925384690, 215430220, 0.101563}};
    size_t n = sizeof(p_b)/sizeof(p_b[0]);
    mysort(p_b, n, sizeof(test_struct), compare_test_struct);
    test_struct ans[] = {{-2125286972, 2003543025, 0.189025},
                         {-1417845659, -1119140084, 0.352222},
                         {-1406836364, 217123097, 0.16737},
                         {-1336448236, 1869146920, 0.197217},
                         {-1170970232, 613641466, 0.0319744},
                         {-925384690, 215430220, 0.101563},
                         {-654172947, -1373821604, 0.00731686},
                         {-606803352, -351912708, 0.54285},
                         {-366221015, -126458399, 0.723053},
                         {-337560122, 352710789, 0.249193},
                         {-243642100, -1888439679, 0.281376},
                         {-127025483, 371115427, 0.591437},
                         {-110991212, -510032329, 0.576508},
                         {34617024, -2060044297, 0.672914},
                         {95986820, 362881936, 0.979554},
                         {116260642, 447552228, 0.194252},
                         {233587817, -803492744, 0.947917},
                         {310589293, 1748639608, 0.143025},
                         {500415026, -1704242636, 0.00945362},
                         {769863531, 2122219585, 0.44431}};
    for (size_t i = 0; i < n; ++i)
    {
        ck_assert_int_eq(p_b[i].a, ans[i].a);
        ck_assert_int_eq(p_b[i].b, ans[i].b);
        ck_assert_double_eq(p_b[i].c, ans[i].c);
    }
}
END_TEST

Suite *mysort_suite(void)
{
    Suite *s;
    TCase *tc_pos;

    s = suite_create("mysort");

    tc_pos = tcase_create("positives");
    tcase_add_test(tc_pos, test_mysort_int_5);
    tcase_add_test(tc_pos, test_mysort_int_100);
    tcase_add_test(tc_pos, test_mysort_string_20);
    tcase_add_test(tc_pos, test_mysort_double_50);
    tcase_add_test(tc_pos, test_mysort_struct_20);
    suite_add_tcase(s, tc_pos);
    return s;
}
